<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reserva tu cita | Threasure Barbershop</title>
  <link rel="shortcut icon" href="/images/faviconLogo.png" type="image/x-icon" />
  <link rel="stylesheet" href="/css/normalize.css" />
  <link rel="stylesheet" href="/css/estilos.css" />
  <meta name="theme-color" content="#2091F9" />
  <meta name="description" content="Reserva tu cita en Threasure BarberHouse y obt√©n un estilo √∫nico con atenci√≥n personalizada." />
</head>
<body>

<!-- ENCABEZADO -->
<header class="hero hero--reserva">
  <nav class="nav container">
    <div class="nav__logo">
      <h2 class="nav__title">Threasure BarberHouse</h2>
    </div>

    <ul class="nav__link nav__link--menu">
      <li class="nav__items"><a href="index.html" class="nav__links">Inicio</a></li>
      <li class="nav__items"><a href="servicios.html" class="nav__links">Servicios</a></li>
      <li class="nav__items"><a href="contacto.html" class="nav__links">Contacto</a></li>
      <img src="/images/close.png" alt="Cerrar men√∫" class="nav__close" />
    </ul>

    <div class="nav__menu">
      <img src="/images/menu-wider.png" alt="Abrir men√∫" class="nav__img" />
    </div>
  </nav>

  <section class="hero__container container">
    <h1 class="hero__title">Reserva tu pr√≥xima cita</h1>
    <p class="hero__paragraph">Elige tu horario ideal y aseg√∫rate tu espacio en Threasure Barbershop.</p>
  </section>
</header>

<!-- SECCI√ìN DE RESERVA -->
<main class="container about">
  <h2 class="subtitle">Reserva r√°pida por WhatsApp</h2>
  <p class="about__paragraph">Completa tus datos y confirma tu reserva directamente por WhatsApp.</p>

  <form id="reservaForm" class="footer__form" onsubmit="enviarReserva(event)">
    <div class="footer__imputs">
      <input type="text" id="nombre" placeholder="Tu nombre completo" class="footer__input" required />

      <label class="footer__label">
        <h2 class="subtitle">Selecciona servicio:</h2>
      </label><br />
      <label><input type="checkbox" value="Corte Cl√°sico - S/20" data-precio="20"> Corte Cl√°sico (S/. 20)</label><br />
      <label><input type="checkbox" value="Fade - S/25" data-precio="25"> Fade (S/. 25)</label><br />
      <label><input type="checkbox" value="Dise√±o - S/5" data-precio="5"> Dise√±o (S/. 5)</label><br />
      <label><input type="checkbox" value="Barba - S/5" data-precio="5"> Barba (S/. 5)</label><br />
      <label><input type="checkbox" value="Cejas - S/5" data-precio="5"> Cejas (S/. 5)</label><br />

      <p>Total: <span id="total">S/0</span></p>
      <script>
      document.addEventListener("DOMContentLoaded", () => {
        const totalSpan = document.getElementById("total");
        const checkboxes = document.querySelectorAll('input[type="checkbox"][data-precio]');

        let total = 0;

        checkboxes.forEach(cb => {
          cb.addEventListener("change", () => {
            total = 0;

            checkboxes.forEach(c => {
              if (c.checked) {
                total += Number(c.dataset.precio);
              }
            });

            totalSpan.textContent = "S/" + total;
          });
        });
      });
      </script>



      <!-- SELECCION DE FECHA ------------------------------------------------------------------------  -->
      <h2 class="subtitle">Selecciona fecha</h2>
      <input 
        type="date" 
        id="fecha" 
        class="footer__input" 
        required
      />

      <p id="info-fecha" class="about__paragraph"></p>
      
      <script>
      const fechaInput = document.getElementById("fecha");
      const infoFecha = document.getElementById("info-fecha");
      const horasContainer = document.getElementById("horas-container");

      const diasSemana = [
        "Domingo",
        "Lunes",
        "Martes",
        "Mi√©rcoles",
        "Jueves",
        "Viernes",
        "S√°bado"
      ];

      // === HORARIOS BASE (cada 1 hora) ===
      const horariosBase = [
        "09:00", "10:00", "11:00", "12:00",
        "13:00", "14:00", "15:00", "16:00",
        "17:00", "18:00", "19:00"
      ];

      fechaInput.addEventListener("change", () => {
        const fechaSeleccionada = fechaInput.value;
        if (!fechaSeleccionada) return;

        const fecha = new Date(fechaSeleccionada + "T00:00:00");
        const hoy = new Date();

        // Guardamos hora actual real
        const horaActual = new Date();

        // Limpiar horas SOLO para c√°lculo de d√≠as
        const hoySinHora = new Date();
        hoySinHora.setHours(0, 0, 0, 0);

        const nombreDia = diasSemana[fecha.getDay()];

        const diferenciaMs = fecha - hoySinHora;
        const diasFaltantes = Math.ceil(diferenciaMs / (1000 * 60 * 60 * 24));

        let mensajeDias = "";
        if (diasFaltantes === 0) {
          mensajeDias = "Hoy";
        } else if (diasFaltantes === 1) {
          mensajeDias = "Falta 1 d√≠a";
        } else if (diasFaltantes > 1) {
          mensajeDias = `Faltan ${diasFaltantes} d√≠as`;
        } else {
          mensajeDias = "Fecha pasada";
        }

        infoFecha.innerHTML = `
          <strong>${nombreDia}</strong><br>
          ${mensajeDias}
        `;

        // === GENERAR HORARIOS ===
        generarHorarios(fechaSeleccionada, diasFaltantes, horaActual);
      });

      function generarHorarios(fechaSeleccionada, diasFaltantes, horaActual) {
        horasContainer.innerHTML = "";

        // Si la fecha ya pas√≥ ‚Üí no mostrar horarios
        if (diasFaltantes < 0) {
          horasContainer.innerHTML = "<p>‚ùå No se pueden reservar fechas pasadas</p>";
          return;
        }

        horariosBase.forEach((hora, index) => {
          const [h, m] = hora.split(":").map(Number);

          let disponible = true;

          // Si es HOY ‚Üí bloquear horas pasadas
          if (diasFaltantes === 0) {
            if (
              h < horaActual.getHours() ||
              (h === horaActual.getHours() && m <= horaActual.getMinutes())
            ) {
              disponible = false;
            }
          }

          const input = document.createElement("input");
          input.type = "radio";
          input.name = "hora";
          input.id = `hora${index}`;
          input.value = hora;
          input.disabled = !disponible;
          if (disponible) input.required = true;

          const label = document.createElement("label");
          label.htmlFor = input.id;
          label.style.marginRight = "10px";
          label.style.opacity = disponible ? "1" : "0.4";
          label.textContent = disponible ? hora : `${hora} (No disponible)`;

          horasContainer.appendChild(input);
          horasContainer.appendChild(label);
          horasContainer.appendChild(document.createElement("br"));
        });
      }
    </script>


      <script>
        const infoFecha = document.getElementById("info-fecha");

      fechaInput.addEventListener("change", () => {
        const fechaValor = fechaInput.value;
        if (!fechaValor) return;

        const fechaSeleccionada = new Date(fechaValor + "T00:00:00");
        const hoy = new Date();
        hoy.setHours(0,0,0,0);

        const diasSemana = [
          "Domingo", "Lunes", "Martes", "Mi√©rcoles",
          "Jueves", "Viernes", "S√°bado"
        ];

        const nombreDia = diasSemana[fechaSeleccionada.getDay()];
        const diffTime = fechaSeleccionada - hoy;
        const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

        let textoDias = "";
        if (diffDays === 0) textoDias = "Hoy";
        else if (diffDays === 1) textoDias = "Ma√±ana";
        else textoDias = `Faltan ${diffDays} d√≠as`;

        infoFecha.textContent = `üìÖ ${nombreDia} ${fechaValor} ‚Äî ${textoDias}`;

        cargarHorarios(fechaValor);
      });

      </script>


      <h2 class="subtitle">Horarios Disponibles:</h2>
      <p class="about__paragraph">
        Antes de completar la reserva, aseg√∫rate de que podr√°s asistir a la hora acordada.
        El pago debe realizarse al 100% tras dar clic en "Reservar ahora por WhatsApp".
        Se enviar√° un QR de Yape por WhatsApp o puedes pagar directamente al mismo n√∫mero.
        Una vez verificado el pago, se confirmar√° tu cita.
      </p>

      <div id="horas-container" class="horas__container">
        <!-- Horas generadas por JS -->
      </div>

      <input type="submit" value="Solicitar Cita" class="footer__submit" />
    </div>
  </form>

</button>

</main>






<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>


<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDNFRA_x7eyCtzAL0G8FA0nX9nzgGUBO3c",
    authDomain: "threasure-barberhouse-47923.firebaseapp.com",
    projectId: "threasure-barberhouse-47923",
    storageBucket: "threasure-barberhouse-47923.firebasestorage.app",
    messagingSenderId: "564496230496",
    appId: "1:564496230496:web:458974e3119888d45a7b05",
    measurementId: "G-0C0KYQ91N2"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>


<!-- SCRIPT -------------------------------------- INICIO DEL SCRIPT-->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "threasure-barberhouse-47923.firebaseapp.com",
    projectId: "threasure-barberhouse-47923",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const fechaInput = document.getElementById("fecha");
  const horasContainer = document.getElementById("horas-container");

  const HORARIOS = [
    "08:00 a.m","09:00 a.m.","10:00 a.m.","11:00 a.m.",
    "01:00 p.m.","02:00 p.m.","03:00 p.m.","04:00 p.m.",
    "05:00 p.m.","06:00 p.m.","07:00 p.m.","08:00 p.m."
  ];

  // Convierte "02:00 p.m." ‚Üí 14
  function convertirHora(horaTexto) {
    let [hora, periodo] = horaTexto.split(" ");
    let [h] = hora.split(":");
    h = parseInt(h);

    if (periodo === "p.m." && h !== 12) h += 12;
    if (periodo === "a.m." && h === 12) h = 0;

    return h;
  }

  fechaInput.addEventListener("change", async () => {
    const fechaSeleccionada = fechaInput.value;
    if (!fechaSeleccionada) return;

    horasContainer.innerHTML = "<p>Cargando horarios...</p>";

    const hoy = new Date();
    const fechaHoy = new Date(hoy.toISOString().split("T")[0]);
    const fechaElegida = new Date(fechaSeleccionada + "T00:00:00");

    // FECHA PASADA
    if (fechaElegida < fechaHoy) {
      horasContainer.innerHTML = "<p>Fecha no disponible</p>";
      return;
    }

    const q = query(
      collection(db, "citas"),
      where("fecha", "==", fechaSeleccionada)
    );

    const querySnapshot = await getDocs(q);

    const horasOcupadas = [];
    querySnapshot.forEach(doc => {
      horasOcupadas.push(doc.data().hora);
    });

    renderHoras(horasOcupadas, fechaElegida, hoy);
  });

  function renderHoras(horasOcupadas, fechaElegida, hoy) {
    horasContainer.innerHTML = "";

    const horaActual = hoy.getHours();
    const esHoy = fechaElegida.toDateString() === hoy.toDateString();

    HORARIOS.forEach((horaTexto, i) => {
      const horaNumero = convertirHora(horaTexto);

      const ocupado = horasOcupadas.includes(horaTexto);
      const pasada = esHoy && horaNumero <= horaActual;

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "hora";
      input.id = "hora" + i;
      input.value = horaTexto;
      input.disabled = ocupado || pasada;
      input.required = !(ocupado || pasada);

      const label = document.createElement("label");
      label.htmlFor = input.id;

      if (ocupado) {
        label.textContent = `${horaTexto} (Ocupado)`;
      } else if (pasada) {
        label.textContent = `${horaTexto} (No disponible)`;
      } else {
        label.textContent = horaTexto;
      }

      horasContainer.appendChild(input);
      horasContainer.appendChild(label);
      horasContainer.appendChild(document.createElement("br"));
    });
  }

  // ENV√çO DE RESERVA
  window.enviarReserva = async function(e) {
    e.preventDefault();

    const nombre = document.getElementById("nombre").value;
    const fecha = fechaInput.value;
    const hora = document.querySelector('input[name="hora"]:checked')?.value;

    if (!hora) {
      alert("Selecciona un horario");
      return;
    }

    await addDoc(collection(db, "citas"), {
      nombre,
      fecha,
      hora,
      estado: "pendiente"
    });

    const mensaje = `Hola, soy ${nombre}
Quiero reservar una cita:

Fecha: ${fecha}
Hora: ${hora}

`;

    window.open(
      `https://wa.me/51930561385?text=${encodeURIComponent(mensaje)}`,
      "_blank"
    );
  };
</script>




<!-- FINAL DEL SCRIPT- ----------------------------------------------------  FIN-->



<!-- FOOTER -->
<footer class="footer">
  <section class="footer__container container">
    <nav class="nav nav--footer">
      <h2 class="footer__title">THREASURE BARBERHOUSE</h2>
    </nav>
  </section>

  <section class="footer__copy container">
    <!-- Enlace a Instagram -->
        <a href="https://www.instagram.com/threasure_barbershop/" target="_blank" class="footer__icons">
        <img src="/images/instagram.png" class="footer__img">
        </a>

        <!-- Enlace a WhatsApp (con mensaje predeterminado) -->
        <a href="https://wa.me/930561385" target="_blank" class="footer__icons">
        <img src="/images/whatsapp.png" class="footer__img">
        </a>
    <h3 class="footer__copyright">¬© 2025 Threasure BarberHouse | Rogger Vega. Todos los derechos reservados.</h3>
  </section>
</footer>

<script src="/js/menu.js"></script>
</body>
</html>
